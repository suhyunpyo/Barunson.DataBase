IF OBJECT_ID (N'dbo.SP_EXEC_CREATE_DELIVERY_DELCODE_FOR_CJ', N'P') IS NOT NULL DROP PROCEDURE dbo.SP_EXEC_CREATE_DELIVERY_DELCODE_FOR_CJ
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/*
    EXEC SP_EXEC_CREATE_DELIVERY_DELCODE_FOR_CJ 36100000000, 36100000010

    SELECT * FROM CJ_DELCODE

    2015-07-28 지급 30만건
    33501790718 ~ 33502090717

    2018-07-09 지급 30만건
    34609589001 ~ 34609889000

    EXEC SP_EXEC_CREATE_DELIVERY_DELCODE_FOR_CJ 33501790718, 33502090717

	2020-10-22 지급 24만건
	EXEC SP_EXEC_CREATE_DELIVERY_DELCODE_FOR_CJ_tmp 38560063601, 38560303600


	2022-05-17 지급 24만건 
	EXEC SP_EXEC_CREATE_DELIVERY_DELCODE_FOR_CJ  56517429057 , 56517669056


*/
CREATE PROCEDURE [dbo].[SP_EXEC_CREATE_DELIVERY_DELCODE_FOR_CJ]
    @P_START_NUM AS NUMERIC(11, 0)
,   @P_END_NUM AS NUMERIC(11, 0)
AS
BEGIN
    
    SET NOCOUNT ON;

    DECLARE @START_NUM AS NUMERIC(11, 0)
    DECLARE @END_NUM AS NUMERIC(11, 0)
    DECLARE @CHECK_DIGIT AS INT
	DECLARE @DELCODE_SEQ AS INT

    SET @START_NUM = @P_START_NUM
    SET @END_NUM = @P_END_NUM

    WHILE @START_NUM <= @END_NUM
    BEGIN
	    /* 데이터 이관에 대한 DELCODE_SEQ IDENTIY 속성 해제에 따른 ID 증가 값 설정이 변경됨 : 자동증가 -> max + 1 */
        select @DELCODE_SEQ = max(DELCODE_SEQ) + 1 from CJ_DELCODE;

        SET @CHECK_DIGIT = RIGHT(@START_NUM, 9) % 7

        INSERT INTO CJ_DELCODE (DELCODE_SEQ, CODESEQ, CODE, ISUSE, IS_USE)
        VALUES (@DELCODE_SEQ, @START_NUM, CAST(@START_NUM AS VARCHAR(11)) + CAST(@CHECK_DIGIT AS VARCHAR(1)), 0, 0)

        SET @START_NUM = @START_NUM + 1

    END   

END
GO
